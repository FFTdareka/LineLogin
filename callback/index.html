<!DOCTYPE html>
<html>
  <head>
    <title>LINE ログインテスト</title>
    <script type="text/javascript">
      const urlParams = new URLSearchParams(window.location.search);
      const code = urlParams.get('code');
      let rText;
      const xhr = new XMLHttpRequest();
      xhr.open("POST", "https://api.line.me/oauth2/v2.1/token");
      xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
      var body = JSON.stringify({
        grant_type: "authorization_code",
        code: code,
        redirect_uri: "https%3A%2F%2Ffftdareka.github.io%2FLineLogin%2Fcallback%2F",
        client_id: "2006030047",
        client_secret: "41e68957a7180b6101c6fab87039b1ca"
      });
      xhr.onload = () => {
        if (xhr.readyState == 4 && xhr.status == 201) {
          rText = JSON.parse(xhr.responseText);
        };
      }
      xhr.send(body);
      let token = rText.id_token;
      const xhr2 = new XMLHttpRequest();
      xhr2.open("POST", "https://api.line.me/oauth2/v2.1/verify");
      xhr2.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
      var body = JSON.stringify({
        id_token: token,
        client_id: "2006030047"
      });
      xhr2.onload = () => {
        if (xhr2.readyState == 4 && xhr2.status == 201) {
          rText = JSON.parse(xhr2.responseText);
        };
      }
      xhr2.send(body);
      let uid = rText.sub;
      let uname = rText.name;
      let p = document.createElement("p");
      p.innerText = "uid: " + uid + "   uname: " + uname;
      document.body.appendChild(p);
    </script>
  </head>
  <body>

  </body>
</html>
